<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MusicGen Web</title>
    <style>
      body { font-family: Arial, Helvetica, sans-serif; margin: 2rem; }
      textarea { width: 100%; height: 120px; }
      .controls { margin-top: 1rem; }
    </style>
  </head>
  <body>
    <h1>MusicGen â€” Convert Your Words Into Captivating Melodies</h1>
    <p>Enter a text prompt and click Generate. This will call the backend model and return a WAV file.</p>

    <label for="prompt">Prompt</label>
    <textarea id="prompt">A relaxed lo-fi hip-hop beat with soft piano and vinyl crackle</textarea>

    <div class="controls">
      <label>Max new tokens: <input id="max_new_tokens" type="number" value="256" min="1" max="3000"/></label>
      <label style="margin-left:1rem">Guidance scale: <input id="guidance_scale" type="number" value="3" step="0.1" min="0" max="10"/></label>
      <label style="margin-left:1rem">Sampling: <input id="do_sample" type="checkbox" checked/></label>
    </div>

    <div style="margin-top:1rem">
      <button id="generate">Generate</button>
      <span id="status" style="margin-left:1rem"></span>
    </div>

    <div id="result" style="margin-top:1.5rem"></div>

    <script>
      document.getElementById('generate').addEventListener('click', async () => {
        const prompt = document.getElementById('prompt').value;
        const max_new_tokens = Number(document.getElementById('max_new_tokens').value);
        const guidance_scale = Number(document.getElementById('guidance_scale').value);
        const do_sample = document.getElementById('do_sample').checked;

        const status = document.getElementById('status');
        status.textContent = 'Generating... this could take some time.';
        document.getElementById('result').innerHTML = '';

        try {
          const res = await fetch('/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: prompt, max_new_tokens, guidance_scale, do_sample })
          });

          if (!res.ok) {
            const err = await res.json();
            status.textContent = 'Error: ' + (err.error || res.statusText);
            return;
          }

          const blob = await res.blob();
          const url = URL.createObjectURL(blob);

          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = url;

          const link = document.createElement('a');
          link.href = url;
          link.download = 'generated.wav';
          link.textContent = 'Download WAV';
          link.style.display = 'inline-block';
          link.style.marginLeft = '1rem';

          const div = document.getElementById('result');
          div.appendChild(audio);
          div.appendChild(link);

          status.textContent = 'Done.';
        } catch (e) {
          status.textContent = 'Error: ' + e.message;
        }
      });
    </script>
  </body>
</html>
